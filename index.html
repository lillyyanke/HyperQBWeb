<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <title>HyperQB To-Go</title>
</head>
<body>
    <div class="grid-2">
        <div class="section-1">
            <i class="fas fa-code fa-5x white"></i>
            <h2>HyperQB Web UI Project</h2>
            <p>Summer 2024</p>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-linkedin"></i></a>
            <a href="#"><i class="fab fa-github"></i></a>
        </div>
    </div>
            <form id="runForm" method="post" enctype="multipart/form-data">

                <div class="form-row">
                    <label for="examples">Try an Example:</label>
                    <select id="examples" name="examples">
                        <option value="" disabled selected>Select an example</option>
                        <option value="example1">Example 1</option>
                        <option value="example2">Example 2</option>
                        <option value="example3">Example 3</option>
                    </select>
                </div>

                <!--Model 1 init input box for typing input -->
                <div class="form-row">
                 <label for="model_1_init">Model 1 init:</label>
                 <input type="text" id="model_1_init" name="model_1_init">
                </div>

                <div class="form-row">
                 <!-- File input field for selecting a file -->
                 <label for="model_1_init_select">Or Select a File:</label>
                 <input type="file" id="model_1_init_select" name="model_1_init_select">
                </div>

                <div class="form-row">
                    <!-- Textarea for displaying file contents -->
                    <textarea id="fileContent1" rows="5" cols="30" placeholder="File contents will appear here..."></textarea>
                </div>

                <!--Model 1 trans input box for typing file name -->
                <div class="form-row">
                    <label for="model_1_trans">Model 1 trans:</label>
                    <input type="text" id="model_1_trans" name="model_1_trans">
                   </div>
   
                   <div class="form-row">
                    <!-- File input field for selecting a file -->
                    <label for="model_1_trans_select">Or Select a File:</label>
                    <input type="file" id="model_1_trans_select" name="model_1_trans_select">
                   </div>        

                <div class="form-row">
                    <!-- Textarea for displaying file contents -->
                    <textarea id="fileContent2" rows="5" cols="30" placeholder="File contents will appear here..."></textarea>
                </div>
                   
                <!--Model 2 init input box for typing input -->
                <div class="form-row">
                    <label for="model_2_init">Model 2 init:</label>
                    <input type="text" id="model_2_init" name="model_2_init">
                   </div>
   
                   <div class="form-row">
                    <!-- File input field for selecting a file -->
                    <label for="model_2_init_select">Or Select a File:</label>
                    <input type="file" id="model_2_init_select" name="model_2_init_select">
                   </div>

                   <div class="form-row">
                    <!-- Textarea for displaying file contents -->
                    <textarea id="fileContent3" rows="5" cols="30" placeholder="File contents will appear here..."></textarea>
                </div>
   
                   <!--Model 2 trans input box for typing file name -->
                   <div class="form-row">
                       <label for="model_2_trans">Model 2 trans:</label>
                       <input type="text" id="model_2_trans" name="model_2_trans">
                      </div>
      
                      <div class="form-row">
                       <!-- File input field for selecting a file -->
                       <label for="model_2_trans_select">Or Select a File:</label>
                       <input type="file" id="model_2_trans_select" name="model_2_trans_select">
                      </div>     

                <div class="form-row">
                    <!-- Textarea for displaying file contents -->
                    <textarea id="fileContent4" rows="5" cols="30" placeholder="File contents will appear here..."></textarea>
                </div>    


                <!--P.hq input -->
                <div class="form-row">
                    <label for="p_hq">P.hq :</label>
                    <input type="text" id="p_hq" name="p_hq">
                   </div>
   
                   <div class="form-row">
                    <!-- File input field for selecting a file -->
                    <label for="p_hq_select">Or Select a File:</label>
                    <input type="file" id="p_hq_select" name="p_hq_select">
                   </div>
   
                   <div class="form-row">
                       <!-- Textarea for displaying file contents -->
                       <textarea id="fileContent5" rows="5" cols="30" placeholder="File contents will appear here..."></textarea>
                   </div>


                <!-- -k input -->
                <div class="form-row">
                    <label for="number_k">K:</label>
                    <input type="text" id="number_k" name="number_k">
                   </div>      
                
                <!-- -F input -->
                <div class="form-row">
                    <label for="quantifier_f">F:</label>
                    <input type="text" id="quantifier_f" name="quantifier_f">
                   </div>      
                
                <!-- -f qcir (default for now) -->
                <!-- <div class="form-row">
                    <label for="f_qcir">f (DEFAULT):</label>
                    <input type="text" id="f_qcir" name="f_qcir" value="qcir">
                   </div>       -->
                 
                <!-- -o test/HQ.qcir (default for now) -->
                <!-- <div class="form-row">
                    <label for="o_qcir">o (DEFAULT):</label>
                    <input type="text" id="o_qcir" name="o_qcir" value="qcir">
                   </div>     -->
                   
                <!-- -sem input -->
                <div class="form-row">
                    <label for="semantics">Semantics:</label>
                    <select id="semantics" name="semantics">
                        <option value="PES">PES</option>
                        <option value="OPT">OPT</option>
                        <option value="HPES">HPES</option>
                        <option value="HOPT">HOPT</option>
                    </select>
                   </div>       
                 
                <!-- -n --fast -new NN (default for now) -->
                <!-- <div class="form-row">
                    <label for="nfn">-n --fast -new (DEFAULT):</label>
                    <input type="text" id="nfn" name="nfn" value="NN">
                   </div>        -->

                <!-- test folder number (JUST FOR TESTING) -->
                <div class="form-row">
                    <label for="test_folder">Test folder # just for testing purposes:</label>
                    <input type="text" id="test_folder" name="test_folder">
                   </div>    
   
                 <!-- Add a button to trigger storing the input -->
                 <button type="submit" id="run">Run</button>
                 <br/>
                 <!-- Result display -->
                 <label for="output">Result</label>
                 <textarea id="runOutput" rows="5" cols="50" readonly></textarea>
                 <hr>

                 <!-- Save and download -->
                <button type="button" id="saveCase">Save Current Case</button>

                <hr>

                 <!-- clearn interface button -->
                <button type="button" id="clearCase">Clear Current Case</button>

            </form>

            
        </div>

    <script>
        const examples = {
            example1: {
                test_folder: '',
                model_1_init: 'I_1.bool',
                model_1_trans: 'R_1.bool',
                model_2_init: 'I_2.bool',
                model_2_trans: 'R_2.bool',
                p_hq: 'P.hq',
                number_k: '3',
                quantifier_f: 'AA',
                semantics: 'PES',
                nfn: 'NN'
            },
            example2: {
                test_folder: '2',
                model_1_init: 'I_1.bool',
                model_1_trans: 'R_1.bool',
                model_2_init: 'I_2.bool',
                model_2_trans: 'R_2.bool',
                p_hq: 'P.hq',
                number_k: '3',
                quantifier_f: 'AA',
                semantics: 'OPT',
                nfn: 'NN'
            },
            example3: {
                test_folder: '3',
                model_1_init: 'I_1.bool',
                model_1_trans: 'R_1.bool',
                model_2_init: 'I_2.bool',
                model_2_trans: 'R_1.bool',
                p_hq: 'P.hq',
                number_k: '3',
                quantifier_f: 'AA',
                semantics: 'PES',
                nfn: 'NN'
            }
        };

        document.getElementById('examples').addEventListener('change', function(event) {
            const selectedExample = event.target.value;
            const exampleData = examples[selectedExample];
            if (exampleData) {
                document.getElementById('test_folder').value = exampleData.test_folder;
                document.getElementById('number_k').value = exampleData.number_k;
                document.getElementById('quantifier_f').value = exampleData.quantifier_f;
                document.getElementById('semantics').value = exampleData.semantics;
                document.getElementById('p_hq').value = exampleData.p_hq;
                //document.getElementById('nfn').value = exampleData.nfn;

                // Load file contents into corresponding textareas
                loadFileContents(exampleData.model_1_init, 'model_1_init', exampleData.test_folder);
                loadFileContents(exampleData.model_1_trans, 'model_1_trans', exampleData.test_folder);
                loadFileContents(exampleData.model_2_init, 'model_2_init', exampleData.test_folder);
                loadFileContents(exampleData.model_2_trans, 'model_2_trans', exampleData.test_folder);
                loadFileContents(exampleData.p_hq, 'p_hq', exampleData.test_folder);
            }
        });

        function loadFileContents(fileName, textareaId, folder) {
            fetch('./test' + folder + '/' + fileName)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    document.getElementById(textareaId).value = data;
                })
                .catch(error => {
                    console.error('There was a problem with fetching the file:', error);
                    alert('There was a problem with fetching the file contents.');
                });
        }

        // Function to clear interface elements
        function clearInterface() {
            // Clear input boxes
            document.getElementById('model_1_init').value = '';
            document.getElementById('model_1_trans').value = '';
            document.getElementById('model_2_init').value = '';
            document.getElementById('model_2_trans').value = '';
            document.getElementById('number_k').value = '';
            document.getElementById('quantifier_f').value = '';
            document.getElementById('semantics').value = '';
            document.getElementById('p_hq').value = '';
            //document.getElementById('nfn').value = '';
            document.getElementById('test_folder').value = '';

            // Reset file input fields
            document.getElementById('model_1_init_select').value = '';
            document.getElementById('model_1_trans_select').value = '';
            document.getElementById('model_2_init_select').value = '';
            document.getElementById('model_2_trans_select').value = '';
            document.getElementById('p_hq_select').value = '';

            // Clear file contents textareas
            document.getElementById('fileContent1').textContent = '';
            document.getElementById('fileContent2').textContent = '';
            document.getElementById('fileContent3').textContent = '';
            document.getElementById('fileContent4').textContent = '';
            document.getElementById('fileContent5').textContent = '';

            //Clear result
            document.getElementById('runOutput').innerText = '';
        }    


        document.getElementById('model_1_init_select').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('fileContent1').textContent = e.target.result;
                };
                reader.onerror = function(e) {
                    alert('Error reading file: ' + e.target.error.name);
                };
                reader.readAsText(file);
            } else {
                alert('Please select a valid .bool file');
            }
        });

        document.getElementById('model_1_trans_select').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('fileContent2').textContent = e.target.result;
                };
                reader.onerror = function(e) {
                    alert('Error reading file: ' + e.target.error.name);
                };
                reader.readAsText(file);
            } else {
                alert('Please select a valid .bool file');
            }
        });

        document.getElementById('model_2_init_select').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('fileContent3').textContent = e.target.result;
                };
                reader.onerror = function(e) {
                    alert('Error reading file: ' + e.target.error.name);
                };
                reader.readAsText(file);
            } else {
                alert('Please select a valid .bool file');
            }
        });

        document.getElementById('model_2_trans_select').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('fileContent4').textContent = e.target.result;
                };
                reader.onerror = function(e) {
                    alert('Error reading file: ' + e.target.error.name);
                };
                reader.readAsText(file);
            } else {
                alert('Please select a valid file');
            }
        });

        document.getElementById('p_hq_select').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('fileContent5').textContent = e.target.result;
                };
                reader.onerror = function(e) {
                    alert('Error reading file: ' + e.target.error.name);
                };
                reader.readAsText(file);
            } else {
                alert('Please select a valid file');
            }
        });

        // Event listener for Clear Current Case button
        document.getElementById('clearCase').addEventListener('click', function(event) {
            event.preventDefault();
            clearInterface();
        });

        document.getElementById('runForm').addEventListener('submit', function(event) {
            event.preventDefault();
                const model_1_init = document.getElementById('model_1_init').value;
                const model_1_trans = document.getElementById('model_1_trans').value;
                const model_1_init_select = document.getElementById('model_1_init_select').files[0];
                const model_1_trans_select = document.getElementById('model_1_trans_select').files[0];

                const model_2_init = document.getElementById('model_2_init').value;
                const model_2_trans = document.getElementById('model_2_trans').value;
                const model_2_init_select = document.getElementById('model_2_init_select').files[0];
                const model_2_trans_select = document.getElementById('model_2_trans_select').files[0];

                const p_hq = document.getElementById('p_hq').value;
                const p_hq_select = document.getElementById('p_hq_select').files[0];

                const number_k = document.getElementById('number_k').value;
                const quantifier_f = document.getElementById('quantifier_f').value;
                const semantics = document.getElementById('semantics').value;
                //const nfn = document.getElementById('nfn').value;

                const test_folder = document.getElementById('test_folder').value;

                let formData = new FormData();

                formData.append('test_folder', test_folder || '');
                formData.append('model_1_init_select', model_1_init_select);
                formData.append('model_1_init', model_1_init);
                formData.append('model_1_trans_select', model_1_trans_select);
                formData.append('model_1_trans', model_1_trans);
                formData.append('model_2_init_select', model_2_init_select);
                formData.append('model_2_init', model_2_init);
                formData.append('model_2_trans_select', model_2_trans_select);
                formData.append('model_2_trans', model_2_trans);
                formData.append('p_hq_select', p_hq_select);
                formData.append('p_hq', p_hq);
                formData.append('number_k', number_k || '3');
                formData.append('quantifier_f', quantifier_f || 'AA');
                formData.append('semantics', semantics || 'PES');
                //formData.append('nfn', nfn || 'NN');

                // Iterate over the formData entries and log them
            for (let [key, value] of formData.entries()) {
                console.log(`${key}: ${value instanceof File ? value.name : value}`);
            }


                fetch('runAll.php', {
                method: 'POST',
                body: formData
                })  
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        document.getElementById('runOutput').innerText = `Error: ${data.error}`;
                    } else {
                        document.getElementById('runOutput').innerText = `${data.result}`;
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                    document.getElementById('runOutput').innerText = 'An error occurred while processing the request.';
                });
            });
     </script>
</body>
</html>
